<!doctype html>

<html lang="pl">
<head>
<title>Programowanie Gier 2D Mateusz J.</title>
  <meta charset="utf-8">
  <meta name="description" content="Zrealizowanie gry w ramach zadania Animacja 1.">
  <meta name="author" content="Mateusz Janiak">
</head>

<body>
    <a href="index.html">Wroc</a><br/>

    <canvas id="bubbleGame" width="800" height="600" style="border:2px solid #d3d3d3;"> </canvas><br />
    <script>
        // helper functions

        // generate rgb string from integer values
        function rgb(r, g, b){
            return "rgb("+r+","+g+","+b+")";
        }

        // arrow listener
        function keyCallback(event){
            switch (event.key) {
                case "ArrowLeft":
                    refreshRect(-1)
                    break;
                case "ArrowRight":
                    refreshRect(1)
                    break;
                case " ":
                    shot()
                    break;
            }
        }

        // function is refreshing scene, redraw all elements
        function refreshScene()
        {
            canvas.width = canvas.width;
            if (bulletPositionX != 0){
                updateBubble(bulletPositionX, bulletPositionY, bulletRadius, bulletColor);
            }
            updateRect(rectPositionX, rectPositionY, rectWidth, rectHeight, rectColor);
            updateTargets(targetsPositionX, targetPositionY, targetRadius, targetColor);
        }

        // refresh rectange image
        function refreshRect(sign){
            const rectStep = 10;
            rectPositionX = rectPositionX + rectStep * sign;
        }

        // create bullets params and define shot loop
        function shot(){
            const bulletDelay = 5;
            const bulletStep = 1;
            if (bulletPositionX == 0){
                bulletPositionX = rectPositionX + rectWidth / 2.0;
                bulletPositionY = rectPositionY - bulletRadius;
                var bulletMove = setInterval(function a(){
                    bulletPositionY -= bulletStep;
                    if (bulletPositionY < 0){
                        clearInterval(bulletMove);
                        bulletPositionX = 0;
                    }
                } , bulletDelay);
            }
        }

        // update bubble
        function updateBubble(x, y, r, color){
            ctx.fillStyle = color;
            arc = ctx.arc(x, y, r, 0, 2 * Math.PI);
            ctx.fill();
        }

        // update rect
        function updateRect(x, y, w, h, color){
            ctx.fillStyle = rectColor;
            rect = ctx.fillRect(x, y, w, h);
        }

        // generate new target
        function generateTarget(){
            targetsPositionX.push(200);
        }

        // update all targets
        function updateTargets(xTable, y, r, color){
            for (const x of xTable)
            {
                ctx.fillStyle = color;
                target = ctx.arc(x, y, r, 0, 2 * Math.PI);
                ctx.fill();
            }
        }

        // define canvas and create context
        var canvas = document.getElementById("bubbleGame");
        var ctx = canvas.getContext("2d");

        // define rectangle params
        const rectColor = rgb(231, 123, 132);
        const rectWidth = canvas.offsetWidth / 8.0;
        const rectHeight = canvas.offsetWidth / 40.0;
        const rectPositionY = canvas.offsetHeight - rectHeight;
        var rectPositionX = canvas.offsetWidth / 2.0 - rectWidth / 2.0;

        // create rectangle
        ctx.fillStyle = rectColor;
        rect = ctx.fillRect(rectPositionX, rectPositionY, rectWidth, rectHeight);
        ctx.stroke();

        // register events
        window.addEventListener('keydown', this.keyCallback, event)

        // set up bullet params
        const bulletColor = rgb(0, 0, 180);
        const bulletRadius = rectHeight / 2.0;
        var bulletPositionX = 0;
        var bulletPositionY = 0;

        // set up target params
        const targetColor = rgb(200, 20, 20);
        const targetRadius = bulletRadius * 3;
        const targetPositionY = targetRadius + 10;
        var targetsPositionX = [];
        const newTargetDelay = 500;
        setInterval(function newTarget(){
                generateTarget();
             } , newTargetDelay);

        // settings scene refresh params
        const sceneRefreshDelay = 33;
        setInterval(function refresh(){
                refreshScene();
             } , sceneRefreshDelay);

    </script>
</body>
</html>
